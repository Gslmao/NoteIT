<!DOCTYPE html>
<html>
<head>
    <title>Your Notes</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        input, textarea, button { width: 100%; padding: 10px; margin: 8px 0; }
        .note { padding: 12px; border: 1px solid #ccc; margin: 8px 0; }
    </style>
</head>
<body>

<h2>Welcome to Your Notes</h2>

<button onclick="logout()">Logout</button>

<hr>

<h3>Create Note</h3>
<input id="title" placeholder="Title">
<textarea id="content" placeholder="Content"></textarea>

<button onclick="createNote()">Create Note</button>

<hr>

<h3>Your Notes</h3>
<button onclick="fetchNotes()">Load Notes</button>

<div id="notesContainer"></div>

<script>
const TOKEN = localStorage.getItem("token");

if (!TOKEN) {
    alert("You must log in first!");
    window.location.href = "login.html";
}

// --------- CREATE NOTE -----------
async function createNote() {
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;

    const res = await fetch("http://localhost:5000/api/notes", {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + TOKEN,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ title, content })
    });

    alert("Note created!");
}

// --------- FETCH NOTES -----------
async function fetchNotes() {
    const res = await fetch("http://localhost:5000/api/notes/fetch", {
        method: "GET",
        headers: {
            "Authorization": "Bearer " + TOKEN
        }
    });

    const notes = await res.json();
    console.log(notes);

    const container = document.getElementById("notesContainer");
    container.innerHTML = "";

    notes.forEach(note => {
        const div = document.createElement("div");
        div.className = "note";

        div.innerHTML = `
            <b>${note.title}</b><br>
            ${note.content}<br><br>
            <button onclick="deleteNote('${note._id}')">Delete</button>
        `;

        container.appendChild(div);
    });
}

// --------- DELETE NOTE -----------
async function deleteNote(id) {
    const res = await fetch(`http://localhost:5000/api/notes/${id}`, {
        method: "DELETE",
        headers: {
            "Authorization": "Bearer " + TOKEN
        }
    });

    alert("Note deleted!");
    fetchNotes();
}

// --------- LOGOUT -----------
function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
}
</script>

</body>
</html>
